# Документация схемы базы данных

## Схема документов

### 0. Справочные таблицы

#### Language (Языки)
| Атрибут              | Тип                   | Описание                                                           |
|----------------------|-----------------------|--------------------------------------------------------------------|
| lang_id(PK)          | SERIAL                | Уникальный ID языка                                                |
| lang_code            | VARCHAR(3)            | Код языка (ISO 639-3)                                              |
| name                 | VARCHAR               | Язык                                                               |

#### ArchiveLocation (Локации архивов)
| Атрибут              | Тип                   | Описание                                                           |
|----------------------|-----------------------|--------------------------------------------------------------------|
| location_id(PK)      | SERIAL                | Уникальный ID локации                                              |
| location             | TEXT                  | Название локации                                                   |
| coordinates          | GEOMETRY              | Географические координаты (PostGIS)                                |

### 1. Основные сущности

#### Archive (Архив)
| Атрибут              | Тип                   | Описание                                                           |
|----------------------|-----------------------|--------------------------------------------------------------------|
| archive_id(PK)       | SERIAL                | Уникальный ID архива                                              |
| location_id(FK)      | INTEGER               | Ссылка на локацию архива                                          |
| name                 | VARCHAR               | Краткое название архива                                           |
| full_name            | TEXT                  | Полное официальное название                                       |

#### ArchiveDetails (Детали архива)
| Атрибут              | Тип                   | Описание                                                           |
|----------------------|-----------------------|--------------------------------------------------------------------|
| details_id(PK)       | SERIAL                | Уникальный ID деталей                                             |
| archive_id(FK)       | INTEGER               | Ссылка на родительский архив                                      |
| collection           | TEXT                  | Название коллекции (Franklin Papers)                               |
| details              | TEXT                  | Детали хранения (том, фолио и т.д.)                              |
| UNIQUE(archive_id, collection, details) | | Уникальная комбинация параметров хранения |

#### Document (Документ)
| Атрибут              | Тип                   | Описание                                                           |
|----------------------|-----------------------|--------------------------------------------------------------------|
| document_id(PK)      | SERIAL                | Уникальный ID документа                                           |
| lang_id(FK)          | INTEGER               | Язык документа                                                    |
| is_translation       | BOOLEAN               | Флаг перевода                                                     |
| title                | TEXT                  | Оригинальное название документа                                   |
| date                 | DATE                  | Дата написания документа                                           |
| date_style           | DATE_STYLE_ENUM       | Календарный стиль (OLD_STYLE/NEW_STYLE)                          |
| status               | DOC_STATUS_ENUM       | Статус документа (ORIGINAL/COPY/DRAFT)                           |

### 2. Исторические персоналии

#### Person (Персоны)
| Атрибут              | Тип                   | Описание                                                           |
|----------------------|-----------------------|--------------------------------------------------------------------|
| person_id(PK)        | SERIAL                | Уникальный ID персоны                                             |
| normalized_name      | TEXT                  | Унифицированное полное имя                                        |
| birth_date           | DATE                  | Дата рождения                                                     |
| death_date           | DATE                  | Дата смерти                                                       |
| bio                  | TEXT                  | Биографическая справка                                            |

#### Organization (Организации)
| Атрибут              | Тип                   | Описание                                                           |
|----------------------|-----------------------|--------------------------------------------------------------------|
| org_id(PK)           | SERIAL                | Уникальный ID организации                                         |
| name                 | TEXT                  | Историческое название организации                                 |

### 3. Связующие таблицы

#### DocumentArchive
| Атрибут              | Тип                   | Описание                                                           |
|----------------------|-----------------------|--------------------------------------------------------------------|
| archive_id(FK)       | INTEGER               | Ссылка на архив                                                   |
| document_id(FK)      | INTEGER               | Ссылка на документ                                                |

#### DocumentActor
| Атрибут              | Тип                   | Описание                                                           |
|----------------------|-----------------------|--------------------------------------------------------------------|
| document_id(FK)      | INTEGER               | Ссылка на документ                                                |
| person_id(FK)        | INTEGER               | Ссылка на персону                                                 |
| org_id(FK)           | INTEGER               | Ссылка на организацию                                             |
| role                 | ROLE_ENUM             | Роль в документе (отправитель/получатель/упомянутый)              |

---

## Схема NER-сущностей


### 1. Хранение сущностей

#### NERTerm (Термины)
| Атрибут              | Тип                   | Описание                                                           |
|----------------------|-----------------------|--------------------------------------------------------------------|
| term_id(PK)          | SERIAL                | Уникальный ID термина                                             |
| lang_id(FK)          | INTEGER               | Язык термина                                                      |
| term                 | TEXT                  | Оригинальное написание ("полунощная Аврора")                      |
| synonyms             | JSONB                 | Синонимы и варианты написания                                     |
| description          | TEXT                  | Описание                                                           |
| modern_equivalent    | TEXT                  | Современный эквивалент (при наличии)                              |

#### NEREvent (События)
| Атрибут              | Тип                   | Описание                                                           |
|----------------------|-----------------------|--------------------------------------------------------------------|
| event_id(PK)         | SERIAL                | Уникальный ID события                                             |
| name                 | TEXT                  | Название события                                                  |
| start_date           | DATE                  | Дата начала                                                       |
| end_date             | DATE                  | Дата окончания                                                    |
| description          | TEXT                  | Историческое описание                                             |

#### NERLocation (Локации)
| Атрибут              | Тип                   | Описание                                                           |
|----------------------|-----------------------|--------------------------------------------------------------------|
| location_id(PK)      | SERIAL                | Уникальный ID локации                                             |
| location             | TEXT                  | Упоминаемое в тексте название                                     |

#### NERPersonMention (Упоминания персон)
| Атрибут              | Тип                   | Описание                                                           |
|----------------------|-----------------------|--------------------------------------------------------------------|
| mention_id(PK)       | SERIAL                | Уникальный ID упоминания                                          |
| role                 | VARCHAR(50)           | Упоминаемая роль/звание                                           |

### 2. Система аннотаций

#### NERAnnotation (Аннотации)
| Атрибут              | Тип                   | Описание                                                           |
|----------------------|-----------------------|--------------------------------------------------------------------|
| annotation_id(PK)    | SERIAL                | Уникальный ID аннотации                                           |
| document_id(FK)      | INTEGER               | Ссылка на исходный документ                                       |
| entity_type          | ENUM                  | Тип сущности (term/event/location/person)                         |
| term_id(FK)          | INTEGER               | Связанный термином                                               |
| event_id(FK)         | INTEGER               | Связанное событие                                                |
| location_id(FK)      | INTEGER               | Связанная локация                                                |
| mention_id(FK)       | INTEGER               | Связанное упоминание персоны                                     |
| start_pos            | INT                   | Начальная позиция в тексте                                       |
| end_pos              | INT                   | Конечная позиция в тексте                                        |

#### ExternalReference (Внешние ссылки)
| Атрибут              | Тип                   | Описание                                                           |
|----------------------|-----------------------|--------------------------------------------------------------------|
| ref_id(PK)           | SERIAL                | Уникальный ID ссылки                                              |
| entity_type          | ENUM                  | Тип связанной сущности                                           |
| entity_id            | INTEGER               | ID в соответствующей таблице                                      |
| wikidata_id          | VARCHAR(50)           | Идентификатор в Wikidata                                          |